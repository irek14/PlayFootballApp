@{
    ViewData["Title"] = "Home Page";
}

<form method="post">
    <div class="col-12 row">
        <div class="col-3"></div>
        <div class="col-6">
            <h2 class="display-4">Wyszukaj wydarzenia</h2>
        </div>
        <div class="col-3"></div>
        <div class="row col-12">
            <div class="col-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Parametry podstawowe</h5>
                        <div class="form-group col-md-12 row">
                            <label class="control-label">Liczba miejsc</label>
                            <input type="number" value="1" min="1" class="form-control" />
                            <span class="text-danger"></span>
                        </div>
                        <div class="form-group col-md-12 row">
                            <label class="control-label">Od</label>
                            <input type="date" class="form-control" />
                            <span class="text-danger"></span>
                        </div>
                        <div class="form-group col-md-12 row">
                            <label class="control-label">Do:</label>
                            <input type="date" class="form-control" />
                            <span class="text-danger"></span>
                        </div>
                        <a asp-action="FindEvents" asp-controller="Home" class="btn btn-primary pull-right">Wyszukaj boiska</a>
                    </div>
                </div>
            </div>
            <div class="col-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Lokalizacja</h5>
                        <div class="medium-map" id="map"></div>
                        <div class="form-group col-md-12 row mt-3">
                            <label class="control-label">Boiska w promieniu (km)</label>
                            <input type="number" value="1" min="0.1" step="0.1" class="form-control" />
                            <span class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</form>

<script>
    var mapsPlaceholder = [];
    var marker;

    $(document).ready(function () {
        L.Map.addInitHook(function () {
            mapsPlaceholder.push(this); // Use whatever global scope variable you like.
        });

        var mymap = L.map('map').setView([52.222, 21.007], 12);

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'pk.eyJ1IjoiaXJla2lzIiwiYSI6ImNrMnAyNmZhdjAyc2gzbXBsczJwMmlrNWgifQ.YUpHsfR2Kyp-K8cJD6rRHw'
        }).addTo(mymap);

        //TODO: Fix this
     //   mymap.addControl( new L.Control.Search({
		   // url: 'https://nominatim.openstreetmap.org/search?format=json&q={s}',
		   // jsonpParam: 'json_callback',
		   // propertyName: 'display_name',
		   // propertyLoc: ['lat','lon'],
		   // marker: L.circleMarker([0,0],{radius:30}),
		   // autoCollapse: true,
		   // autoType: false,
		   // minLength: 2,
	    //}) );

        mymap.on('click', onMapClick);
    });

    function onMapClick(e) {
        var mymap = mapsPlaceholder.pop();
        if (marker != undefined)
            mymap.removeLayer(marker);

        var locX = e.latlng.lat + "";
        locX = locX.replace(".", ",");
        var locY = e.latlng.lng + "";
        locY = locY.replace(".", ",");

        //TODO:
        //$("#localisationX").val(locX);
        //$("#localisationY").val(locY);
        marker = L.marker(e.latlng).addTo(mymap);
        mapsPlaceholder.push(mymap);
    }
</script>   